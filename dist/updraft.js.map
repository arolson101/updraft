{"version":3,"sources":["src/util.ts","src/set.ts","src/query.ts","src/model.ts","src/store.ts","src/main.ts"],"names":["Updraft","Updraft.startsWith","Updraft.clone","Updraft.keyOf","Updraft.createClass","Updraft.State","Updraft.Set","Updraft.Set.constructor","Updraft.Set.initFromDb","Updraft.Set.assign","Updraft.Set.clear","Updraft.Set.add","Updraft.Set.push","Updraft.Set.remove","Updraft.Set.which","Updraft.Set.values","Updraft.Set.getAdded","Updraft.Set.getRemoved","Updraft.Set.clearChanges","Updraft.Query","Updraft.Query.constructor","Updraft.Query.all","Updraft.Query.addCondition","Updraft.Query.and","Updraft.Query.where","Updraft.Query.or","Updraft.Query.order","Updraft.Query.nocase","Updraft.Query.limit","Updraft.Query.offset","Updraft.Query.count","Updraft.Query.get","Updraft.Instance","Updraft.Instance.constructor","Updraft.Instance._primaryKey","Updraft.Instance._changes","Updraft.Instance._clearChanges","Updraft.addClassProperty","Updraft.MakeClassTemplate","Updraft.constructFromDb","Updraft.ColumnType","Updraft.Column","Updraft.Column.constructor","Updraft.Column.Key","Updraft.Column.Index","Updraft.Column.Default","Updraft.Column.Int","Updraft.Column.Real","Updraft.Column.Bool","Updraft.Column.Text","Updraft.Column.String","Updraft.Column.Blob","Updraft.Column.Enum","Updraft.Column.Date","Updraft.Column.DateTime","Updraft.Column.JSON","Updraft.Column.Ptr","Updraft.Column.Set","Updraft.Column.sql","Updraft.StoreOptions","Updraft.StoreOptions.constructor","Updraft.Schema","Updraft.Schema.constructor","Updraft.SchemaTable","Updraft.SchemaTable.constructor","Updraft.KeyValue","Updraft.KeyValue.constructor","Updraft.KeyValue.get","Updraft.anyFcn","Updraft.Store","Updraft.Store.constructor","Updraft.Store.addClass","Updraft.Store.set","Updraft.Store.get","Updraft.Store.loadKeyValues","Updraft.Store.purge","Updraft.Store.open","Updraft.Store.close","Updraft.Store.exec","Updraft.Store.execRead","Updraft.Store.reportError","Updraft.Store.readSchema","Updraft.Store.readSchema.tableFromSql","Updraft.Store.syncTables","Updraft.Store.syncTable","Updraft.Store.syncTable.createTable","Updraft.Store.syncTable.dropTable","Updraft.Store.syncTable.createIndices","Updraft.Store.save","value","insertSets","insert","update"],"mappings":"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","file":"../dist/updraft.js","sourcesContent":["module Updraft {\n\n  /**\n   * @private\n   */\n  export function startsWith(str: string, val: string) {\n    return str.lastIndexOf(val, 0) === 0;\n  }\n\n\n  /**\n   * @private\n   */\n  export function clone(obj: any): any {\n    var copy: any;\n\n    // Handle the 3 simple types, and null or undefined\n    if (null === obj || \"object\" !== typeof obj) {\n      return obj;\n    }\n\n    // Handle Array\n    if (obj instanceof Array) {\n      copy = [];\n      for (var i = 0, len = obj.length; i < len; i++) {\n        copy[i] = clone(obj[i]);\n      }\n      return copy;\n    }\n\n    // Handle complicated (read: enum) objects\n    if (obj instanceof Object && obj.constructor.name !== \"Object\") {\n      return obj;\n    }\n\n    // Handle simple Objects\n    if (obj instanceof Object && obj.constructor.name === \"Object\") {\n      copy = {};\n      for (var attr in obj) {\n        if (obj.hasOwnProperty(attr)) {\n          copy[attr] = clone(obj[attr]);\n        }\n      }\n      return copy;\n    }\n\n    throw new Error(\"Unable to copy obj! Its type isn't supported.\");\n  }\n\n  /**\n   * @private\n   */\n  export function keyOf(obj: any): any {\n    if(obj instanceof Instance) {\n      return (<Instance<any>>obj)._primaryKey();\n    }\n    if(typeof(obj) === 'object' && typeof(obj.toString) === 'function') {\n      return obj.toString();\n    }\n    return obj;\n  }\n\n\n  /**\n   * In non-typescript environments, use this function to derive a class from {@link Instance}\n   * @example\n   * ```\n   *\n   *   function Task() { Updraft.Instance.apply(this, arguments); }\n   *   var Task = Updraft.createClass({\n   *     tableName: 'tasks',\n   *     columns: {\n   *       name: Updraft.Column.Text().Key(),\n   *       description: Updraft.Column.Text(),\n   *       done: Updraft.Column.Bool()\n   *     }\n   *   });\n   * ```\n   */\n  export function createClass(proto: Function, descriptor: ClassTemplate<any>) {\n    console.assert(typeof proto === 'function');\n    console.assert(typeof descriptor === 'object');\n\n    proto.prototype = Object.create(Instance.prototype);\n    proto.prototype.constructor = proto;\n\n    for(var key in descriptor) {\n      var value = descriptor[key];\n      if(typeof value === 'function') {\n        proto.prototype[key] = value;\n      } else {\n        proto[key] = descriptor[key];\n      }\n    }\n\n    return proto;\n  }\n\n}\n","/// <reference path=\"./websql.d.ts\" />\n\nmodule Updraft {\n\n  /**\n   * State that a value can be in\n   * @private\n   * @enum\n   */\n  enum State {\n    saved =   1 << 1,\n    added =   1 << 2,\n    removed = 1 << 3\n  }\n\n\n  interface StateMap {\n    [key: string]: State;\n  }\n\n\n  export interface DirtyFunc {\n    (): void;\n  }\n\n\n  export class Set<K> {\n    private _dirtyFcn: DirtyFunc;\n    private _states: StateMap;\n\n    /**\n     * @param dirtyFcn - function to call when set's state changes\n     */\n    constructor(dirtyFcn: DirtyFunc) {\n      this._dirtyFcn = dirtyFcn;\n      this._states = {};\n    }\n\n\n    /**\n     * load values from a database; initialize values\n     * @private\n     * @param results - database row\n     */\n    initFromDb(results: SQLResultSet) {\n      for(var i=0; i<results.rows.length; i++) {\n        var row = results.rows.item(i);\n        console.assert(Object.keys(row).length === 1);\n        var item: string = row[Object.keys(row)[0]];\n        this._states[item] = State.saved;\n      }\n    }\n\n\n    /**\n     * Set all values from an array.  <tt>Add</tt>s all values, and <tt>remove</tt>s any existing set values that are\n     * not in <tt>arr</tt>\n     * @param objects - array of values to assign.  If values are {@link Instance}s, assign their <tt>_primaryKey()</tt>s instead\n     */\n    assign(objects: K[]): void {\n      this.clear();\n      this.add.apply(this, objects);\n    }\n\n\n    /**\n     * Removes all objects from set\n     */\n    clear(): void {\n      for(var val in this._states) {\n        this._states[val] = State.removed;\n      }\n    }\n\n\n    /**\n     * Adds value(s) to set\n     * @param objects - array of values to assign.  If values are {@link Instance}s, assign their <tt>_primaryKey()</tt>s instead\n     */\n    add(...objects: K[]): void {\n      var dirty = false;\n      var self = this;\n      objects\n      .map(keyOf)\n      .forEach(function(arg: string) {\n        console.assert(typeof(arg) !== 'object');\n        if(self._states[arg] !== State.saved) {\n          self._states[arg] = State.added;\n          dirty = true;\n        }\n      });\n      if(dirty) {\n        this._dirtyFcn();\n      }\n    }\n\n\n    /**\n     * Alias for {@link add}\n     * @param objects - values to add\n     */\n    push(...objects: K[]): void {\n      return this.add.apply(this, objects);\n    }\n\n\n    /**\n     * Removes value(s) from set\n     * @param objects - values to remove\n     */\n    remove(...objects: K[]): void {\n      var dirty = false;\n      var self = this;\n      objects\n      .map(keyOf)\n      .forEach(function(arg: string) {\n        self._states[arg] = State.removed;\n        dirty = true;\n      });\n      if(dirty) {\n        this._dirtyFcn();\n      }\n    }\n\n\n    /**\n     * Gets values from set which match the given <tt>stateMask</tt>\n     * @param stateMask - states of objects to return\n     * @return values that match <tt>stateMask</tt>\n     * @private\n     */\n    private which(stateMask: State): string[] {\n      var self = this;\n      return Object.keys(this._states)\n      .filter(function(element, index, array): boolean {\n        return (self._states[<any>element] & stateMask) ? true : false;\n      });\n    }\n\n\n    /**\n     * Gets valid (added or saved) values of the set\n     */\n    values(): string[] {\n      return this.which(State.saved | State.added);\n    }\n\n\n    /**\n     * Gets the values that have been added to the set since it was last saved\n     */\n    getAdded(): string[] {\n      return this.which(State.added);\n    }\n\n\n    /**\n     * Gets the values that have been removed from the set since it was last saved\n     */\n    getRemoved(): string[] {\n      return this.which(State.removed);\n    }\n\n\n    /**\n     * Marks the values in the set as saved.  Any objects marked 'remove' will be\n     * expunged from the set.\n     */\n    clearChanges(): void {\n      var newValues: StateMap = {};\n      for(var val in this._states) {\n        if(this._states[val] !== State.removed) {\n          newValues[val] = State.saved;\n        }\n      }\n      this._states = newValues;\n    }\n  }\n\n}\n","/// <reference path=\"../typings/tsd.d.ts\" />\n/// <reference path=\"./store.ts\" />\n\nmodule Updraft {\n\n  interface Condition {\n    conj: string;\n    col: string;\n    op: string;\n    val: string;\n    arg?: string;\n  }\n\n\n  /**\n   * Do not construct objects of type Query directly- instead, use {@link ClassTemplate}.all\n   * @constructor\n   */\n  export class Query<K, I extends Instance<any>> {\n    private _model: ClassTemplate<K>;\n    private _store: Store;\n    private _justCount: boolean;\n    private _tables: string[];\n    private _columns: string[];\n    private _conditions: Condition[];\n    private _order: any;\n    private _limit: any;\n    private _offset: any;\n    private _asc: boolean;\n    private _nocase: boolean;\n\n    constructor(model: ClassTemplate<K>, store: Store) {\n      console.assert(model != null);\n      console.assert(store != null);\n      this._model = model;\n      this._store = store;\n      this._justCount = false;\n      this._tables = [model.tableName];\n      this._columns = [];\n      this._conditions = [];\n      this._order = undefined;\n      this._limit = undefined;\n      this._offset = undefined;\n      this._asc = true;\n      this._nocase = false;\n\n      // add child tables\n      for(var col in model.columns) {\n        if(model.columns[col].type !== ColumnType.set) {\n          this._columns.push(model.tableName + '.' + col);\n        }\n      }\n    }\n\n\n    all(): Promise<I[]> {\n      return this.get();\n    }\n\n\n    private addCondition(conj: string, col: string, op: string, val: any): Query<K, I> {\n      var fields = col.split(/\\./);\n      var field: string;\n      var f = this._model;\n      val = keyOf(val);\n\n      for(var i=0; i<fields.length - 1; i++) {\n        field = fields[i];\n        console.assert(field in f.columns);\n        var ref = f.columns[field].ref;\n        console.assert(ref != null);\n        if(this._tables.indexOf(ref.tableName) === -1) {\n          this._tables.push(ref.tableName);\n          this._conditions.push({\n            conj: 'AND',\n            col: f.tableName + '.' + field,\n            op: '=',\n            val: ref.tableName + '.' + ref.key\n          });\n        }\n        f = ref;\n      }\n\n      field = fields[fields.length - 1];\n\n      switch(op) {\n        case 'contains':\n          console.assert(f.columns[field].type === ColumnType.set);\n          var setTable = f.columns[field].setTable;\n          console.assert(setTable != null);\n\n          if(this._tables.indexOf(setTable.tableName) === -1) {\n            this._tables.push(setTable.tableName);\n            this._conditions.push({\n              conj: 'AND',\n              col: f.tableName + '.' + f.key,\n              op: '=',\n              val: setTable.tableName + '.' + f.key\n            });\n          }\n\n          this._conditions.push({\n            conj: conj,\n            col: setTable.tableName + '.' + field,\n            op: '=',\n            val: '?',\n            arg: val\n          });\n          break;\n\n        default:\n          console.assert(f.columns[field].type !== ColumnType.set);\n          this._conditions.push({\n            conj: conj,\n            col: f.tableName + '.' + field,\n            op: op,\n            val: '?',\n            arg: val\n          });\n        break;\n      }\n      return this;\n    }\n\n\n    /**\n     * Adds an 'AND' condition to the query\n     *\n     * @param col - column field to match on\n     * @param op - SQLite binary [operator]{@link https://www.sqlite.org/lang_expr.html}\n     * @param val - value to match against `col`\n     * @see {@link or}\n     * @example\n     * ```\n     *\n     *  return Class.all.where('col2', '>', 10).and('col2', '<', 30).get();\n     *  // -> SELECT ... WHERE col2 > 10 AND col2 < 30\n     * ```\n     */\n    and(col: string, op: string, val: any): Query<K, I> {\n      return this.addCondition('AND', col, op, val);\n    }\n\n\n    /**\n     * alias for {@link and}\n     *\n     * @example\n     * ```\n     *\n     *  return Class.all.where('col2', '>', 10).get();\n     * ```\n     */\n    where(): Query<K, I> {\n      return this.and.apply(this, arguments);\n    }\n\n\n    /**\n     * Adds an 'OR' condition to the query\n     *\n     * @param col - column field to match on\n     * @param op - SQLite binary [operator]{@link https://www.sqlite.org/lang_expr.html}\n     * @param val - value to match against `col`\n     * @see {@link and}\n     * @example\n     * ```\n     *\n     *  return Class.all.where('col2', '=', 10).or('col2', '=', 30).get();\n     *  // -> SELECT ... WHERE col2 = 10 OR col2 = 30\n     * ```\n     */\n    or(col: string, op: string, val: any): Query<K, I> {\n      return this.addCondition('OR', col, op, val);\n    }\n\n\n    /**\n     * Sort the results by specified field\n     *\n     * @param col - column to sort by\n     * @param asc - sort ascending (true, default) or descending (false)\n     * @see {@link nocase}\n     * @example\n     * ```\n     *\n     *  return Class.all.order('x').get();\n     *  // -> SELECT ... ORDER BY x\n     * ```\n     */\n    order(col: string, asc: boolean): Query<K, I> {\n      this._order = this._model.tableName + '.' + col;\n      if(typeof asc !== 'undefined') {\n        this._asc = asc;\n      }\n      return this;\n    }\n\n    /**\n     * Changes the match collation to be case-insensitive.  Only applies to result sorting, as 'LIKE' is\n     * always case-insensitive\n     *\n     * @see {@link order}\n     * @example\n     * ```\n     *\n     *  return Class.all.order('x').nocase().get();\n     *  // -> SELECT ... ORDER BY x COLLATE NOCASE\n     * ```\n     */\n    nocase(): Query<K, I> {\n      this._nocase = true;\n      return this;\n    }\n\n\n    /**\n     * Limits the result set to a certain number.  Useful in pagination\n     *\n     * @see {@link offset}\n     * @example\n     * ```\n     *\n     *  return Class.all.limit(5).get();\n     *  // -> SELECT ... FROM ... LIMIT 5\n     * ```\n     */\n    limit(count: number): Query<K, I> {\n      this._limit = count;\n      return this;\n    }\n\n\n    /**\n     * Skip a number of results.  Useful in pagination\n     *\n     * @see {@link limit}\n     * @example\n     * ```\n     *\n     *  return Class.all.limit(10).offset(50).get();\n     *  // -> SELECT ... FROM ... LIMIT 10 OFFSET 50\n     * ```\n     */\n    offset(count: number): Query<K, I> {\n      this._offset = count;\n      return this;\n    }\n\n\n    /**\n     * Executes the query, returning a promise resolving with the count of objects that match\n     *\n     * @see {@link get}\n     * @example\n     * ```\n     *\n     *  return Class.all.count()\n     *  .then(function(count) { console.log(count + \" objects\") });\n     *  // -> SELECT COUNT(*) FROM ...\n     * ```\n     */\n    count(): Promise<number> {\n      this._justCount = true;\n      return <Promise<number>><any>this.get();\n    }\n\n\n    /**\n     * Executes the query, returning a promise resolving with the array of objects that match any conditions\n     * set on the Query\n     *\n     * @see {@link count}\n     * @example\n     * ```\n     *\n     *  return Class.all.where('x', '>', 0).get();\n     *  // -> SELECT ... WHERE x > 0\n     * ```\n     */\n    get(): Promise<I[]> {\n      var countProp = 'COUNT(*)';\n      var stmt = 'SELECT ';\n      var model: ClassTemplate<K> = this._model;\n      if(this._justCount) {\n        stmt += countProp;\n      } else {\n        stmt += this._columns.join(', ');\n      }\n      stmt += ' FROM ' + this._tables.join(', ');\n      var args: string[] = [];\n      for(var i=0; i<this._conditions.length; i++) {\n        var cond = this._conditions[i];\n        stmt += (i === 0) ? ' WHERE ' : (' ' + cond.conj + ' ');\n        stmt += cond.col + ' ' + cond.op + ' ' + cond.val;\n        if('arg' in cond) {\n          args.push(cond.arg);\n        }\n      }\n      if(this._order) {\n        stmt += ' ORDER BY ' + this._order;\n        stmt += (this._nocase ? ' COLLATE NOCASE' : '');\n        stmt += (this._asc ? ' ASC' : ' DESC');\n      }\n      console.assert(!this._offset || this._limit);\n      if(this._limit) {\n        stmt += ' LIMIT ' + this._limit;\n        if(this._offset) {\n          stmt += ' OFFSET ' + this._offset;\n        }\n      }\n\n      var objects: I[] = [];\n      var query = this;\n      return this._store.execRead(stmt, args, function (tx: SQLTransaction, results: SQLResultSet) {\n        if(query._justCount) {\n          return results.rows.item(0)[countProp];\n        }\n        for (var i = 0; i < results.rows.length; i++) {\n          var o = constructFromDb<K, I>(model, results.rows.item(i));\n          objects.push(o);\n        }\n        var setcols = Object.keys(model.columns)\n        .filter(function(col: string): boolean {\n          return (model.columns[col].type === ColumnType.set);\n        });\n        return Promise.all(objects.map(function(o: I) {\n          return Promise.all(\n            setcols.map(function(col: string): Promise<any> {\n              var setTable = model.columns[col].setTable;\n              console.assert(setTable != null);\n              var key = o._primaryKey();\n              var s = 'SELECT ' + col;\n              s += ' FROM ' + setTable.tableName;\n              s += ' WHERE ' + query._model.key + ' = ?';\n              return query._store.exec(tx, s, [key], function(tx: SQLTransaction, results: SQLResultSet) {\n                if(results.rows.length > 0) {\n                  o[col].initFromDb(results);\n                }\n              });\n            })\n          );\n        }))\n        .then(function() {\n          return objects;\n        });\n      });\n    }\n  }\n\n}\n","/// <reference path=\"./util.ts\" />\n/// <reference path=\"./store.ts\" />\n/// <reference path=\"./set.ts\" />\n/// <reference path=\"./query.ts\" />\n\nmodule Updraft {\n\n  export interface RenamedColumnSet {\n    [oldColumnName: string]: string;\n  }\n\n\n  /**\n   * Describes the static members of a class used to create {@link Instance}s\n   * @see {link @createClass}\n   */\n  export interface ClassTemplate<K> {\n    tableName: string;\n    recreate?: boolean;\n    temp?: boolean;\n    columns: ColumnSet;\n    renamedColumns?: RenamedColumnSet;\n    indices?: string[][];\n    key?: string;\n    keyType?: ColumnType;\n    all?: Query<K, Instance<K>>;\n    get(id: K): Promise<Instance<K>>;\n  }\n\n\n  /**\n   * Instances of this type will have properties for all the columns defined in its {@link ClassTemplate}.\n   *  Do not create objects of type Instance directly; instead create subclassed objects\n   *\n   * @see {@link createClass}\n   * @example\n   * ```\n   *\n   *   // ------ typescript ------\n   *   class Task extends Updraft.Instance {\n   *     constructor() {\n   *       super.apply(this, arguments);\n   *     }\n   *\n   *     public name: string;\n   *     public description: string;\n   *     public done: boolean;\n   *\n   *     static tableName: string = 'tasks';\n   *     static columns: Updraft.ColumnSet = {\n   *       name: Updraft.Column.Text().Key(),\n   *       description: Updraft.Column.Text(),\n   *       done: Updraft.Column.Bool()\n   *     };\n   *   }\n   * ```\n   */\n  export class Instance<K> {\n    _changeMask: number;\n    _isInDb: boolean;\n    _model: ClassTemplate<K>;\n    _store: Store;\n\n    constructor(props?: any) {\n      var o = this;\n      o._changeMask = 0;\n\n      for (var key in this._model.columns) {\n        var col: Column = this._model.columns[key];\n        if('defaultValue' in col) {\n          o['_' + key] = col.defaultValue;\n        }\n      }\n\n      props = props || {};\n      for (var key in props) {\n        var value = props[key];\n        if(value instanceof Instance) {\n          value = (<Instance<K>>value)._primaryKey();\n        }\n        o[key] = value;\n      }\n    }\n\n\n    /**\n     * Return the object's primary key's value\n     *\n     * @returns Value of primary key\n     * @private\n     * @example\n     * ```\n     *\n     *  var x = new Class();\n     *  x.id = 123;\n     *  console.log(x._primaryKey());\n     *  // -> '123'\n     * ```\n     */\n    _primaryKey(): K {\n      var key = '_' + this._model.key;\n      console.assert(key in this);\n      return this[key];\n    }\n\n\n\n    /**\n     * Get the fields that have been changed since the object was last loaded/saved\n     *\n     * @returns Names of the fields that have changed\n     * @private\n     * @example\n     * ```\n     *\n     *  var x = new Class();\n     *  x.foo = 'bar';\n     *  console.log(x.changes());\n     *  // -> ['foo']\n     * ```\n     */\n    _changes(): string[] {\n      var changes: string[] = [];\n      var propIdx = 0;\n      for (var col in this._model.columns) {\n        var propMask = (1 << propIdx++);\n        if (this._changeMask & propMask) {\n          changes.push(col);\n        }\n      }\n      return changes;\n    }\n\n\n    /**\n     * Set state to be have no changes\n     * @private\n     */\n    _clearChanges() {\n      this._changeMask = 0;\n      for (var col in this._model.columns) {\n        if(col in this\n          && typeof this[col] !== 'undefined'\n          && typeof this[col]['clearChanges'] === 'function') {\n          this[col].clearChanges();\n        }\n      }\n    }\n  }\n\n\n  interface Wrapper<I extends Instance<any>> {\n    ref: ClassTemplate<I>;\n    own: I;\n    get: () => Promise<I>;\n  }\n\n\n  /**\n   * Add a get/set property to the class\n   *\n   * @param model - class template\n   * @param proto - function prototype\n   * @param col - the column/field to set the property on\n   * @param propMask - the bits to set on <tt>_changes</tt>\n   * @private\n   */\n  function addClassProperty<K>(model: ClassTemplate<K>, proto: any, col: string, propMask: number) {\n    var prop = '_' + col;\n\n    switch(model.columns[col].type) {\n      default:\n        Object.defineProperty(proto, col, {\n          configurable: true,\n          get: function () {\n            return (<Instance<K>>this)[prop];\n          },\n          set: function (val) {\n            if ((<Instance<K>>this)[prop] !== val) {\n              (<Instance<K>>this)[prop] = val;\n              (<Instance<K>>this)._changeMask |= propMask;\n            }\n          }\n        });\n        break;\n\n      case ColumnType.ptr:\n        Object.defineProperty(proto, col, {\n          configurable: true,\n          get: function () {\n            var ref: ClassTemplate<any> = (<Instance<any>>this)._model.columns[col].ref;\n            console.assert(ref.get != null);\n            var ret: Wrapper<Instance<K>> = {\n              ref: ref,\n              own: (<Instance<K>>this),\n              get: function () { return (<Wrapper<K>>this).ref.get(this.own[prop]); }\n            };\n            ret[ref.key] = (<Instance<K>>this)[prop];\n            return ret;\n          },\n          set: function (val) {\n            // allow client to do object.field = otherobject; we'll transform it to object.field = otherobject._primaryKey()\n            val = keyOf(val);\n            if ((<Instance<K>>this)[prop] !== val) {\n              (<Instance<K>>this)[prop] = val;\n              (<Instance<K>>this)._changeMask |= propMask;\n            }\n          }\n        });\n        break;\n\n      case ColumnType.set:\n        Object.defineProperty(proto, col, {\n          configurable: true,\n          get: function() {\n            if(!(prop in (<Instance<K>>this))) {\n              var o: Instance<K> = this;\n              o[prop] = new Set(function() { o._changeMask |= propMask; });\n            }\n            return (<Instance<K>>this)[prop];\n          },\n          set: function(val) {\n            if(!(prop in (<Instance<K>>this))) {\n              var o: Instance<K> = this;\n              o[prop] = new Set(function() { o._changeMask |= propMask; });\n            }\n            (<Instance<K>>this)[prop].assign(val);\n            (<Instance<K>>this)._changeMask |= propMask;\n          }\n        });\n        break;\n    }\n  }\n\n\n\n  /**\n   * Add properties to a provided {@link Instance} subclass that can be created, saved and retrieved from the db\n   * @private\n   */\n  export function MakeClassTemplate<K>(templ: ClassTemplate<K>, store: Store) {\n    console.assert(store != null);\n    console.assert(templ != null);\n    console.assert(templ.tableName != null);\n    console.assert(templ.tableName[0] !== '_');\n    console.assert(templ.columns != null);\n    console.assert(Object.keys(templ.columns).length < 64);\n    console.assert(!('changes' in templ.columns));\n    console.assert(!('template' in templ.columns));\n    console.assert(!templ.renamedColumns || Object.keys(templ.renamedColumns).every(function (old) { return !(old in templ.columns); }));\n\n    // instance properties\n    var proto = (<any>templ).prototype;\n    Object.defineProperty(proto, '_model', { configurable: true, enumerable: true, value: templ });\n    Object.defineProperty(proto, '_store', { configurable: true, enumerable: true, value: store });\n\n    // class static methods/properties\n    templ.get = function (id: K): Promise<Instance<K>> {\n      return this.all.where(this.key, '=', id).get()\n      .then(function(results: Instance<K>[]) {\n        console.assert(results.length < 2);\n        if(results.length === 0) {\n          return null;\n        } else {\n          return results[0];\n        }\n      });\n    }\n\n    Object.defineProperty(templ, 'all', {\n      configurable: true,\n      get: function() {\n        return new Query(this, store);\n      }\n    });\n\n    templ.indices = templ.indices || [];\n\n    var key: string = null;\n    var keyType: ColumnType = null;\n\n    var propIdx = 0;\n    for(var col in templ.columns) {\n      if (templ.columns[col].isKey) {\n        key = col;\n        keyType = templ.columns[col].type;\n      }\n      if (templ.columns[col].isIndex) {\n        templ.indices.push([col]);\n      }\n\n      var propMask = (1 << propIdx++);\n      addClassProperty(templ, proto, col, propMask);\n      if (propIdx >= 63) {\n        throw new Error(\"class has too many columns- max 63\");\n      }\n    }\n\n    console.assert(key != null);\n\n    templ.key = key;\n    templ.keyType = keyType;\n  }\n\n\n\n  /**\n   * construct object from a database result row\n   *\n   * @return Instance with fields initialized according to row, with _isInDb=true and no changes set\n   * @private\n   */\n  export function constructFromDb<K, I extends Instance<any>>(model: ClassTemplate<K>, row: Object): I {\n    var o: I = new (<any>model)();\n    console.assert(o instanceof Instance);\n    for(var col in row) {\n      var val = row[col];\n      var _col = '_' + col;\n      // TODO: refactor this into column class\n      switch(model.columns[col].type) {\n        case ColumnType.json:\n          o[_col] = JSON.parse(val);\n          break;\n        case ColumnType.date:\n        case ColumnType.datetime:\n          o[_col] = new Date(val * 1000);\n          break;\n        case ColumnType.enum:\n          var enumClass = o._model.columns[col].enum;\n          console.assert(enumClass != null);\n          if(typeof enumClass === 'object' && typeof (<EnumClass>enumClass).get == 'function') {\n            o[_col] = (<EnumClass>enumClass).get(val);\n          } else {\n            console.assert(val in enumClass);\n            o[_col] = enumClass[val];\n          }\n          break;\n        case ColumnType.set:\n          o[_col].push(val);\n          break;\n        default:\n          o[_col] = val;\n          break;\n      }\n    }\n\n    o._isInDb = true;\n    console.assert(o._changeMask === 0);\n    return o;\n  }\n\n}\n","/// <reference path=\"../typings/tsd.d.ts\" />\n/// <reference path=\"./util.ts\" />\n/// <reference path=\"./model.ts\" />\n/// <reference path=\"./websql.d.ts\" />\n\nmodule Updraft {\n\n\n  /**\n   * Column types.  Note that these are just column affinities, and technically any value type can be stored in any column type.\n   * see {@link https://www.sqlite.org/datatype3.html}\n   */\n  export enum ColumnType {\n    int,\n    real,\n    bool,\n    text,\n    blob,\n    enum,\n    date,\n    datetime,\n    json,\n    ptr,\n    set\n  }\n\n  /** An enum class (e.g. (this one)[https://github.com/adrai/enum]) should provide a static method 'get' to resolve strings into enum values */\n  export interface EnumClass {\n    get(value: string): any;\n  }\n\n  /** A typescript enum class will have string keys resolving to the enum values */\n  export interface TypeScriptEnum {\n    [enumValue: string]: number\n  }\n\n\n  /**\n   * Column in db.  Use static methods to create columns.\n   */\n  export class Column {\n    public isKey: boolean;\n    public isIndex: boolean;\n    public type: ColumnType;\n    public ref: ClassTemplate<any> /*| ColumnType*/; // TODO: add set(string|number|etc)\n    public setTable: ClassTemplate<any>;\n    public defaultValue: number | boolean | string;\n    public enum: EnumClass | TypeScriptEnum;\n\n    constructor(type: ColumnType) {\n      this.type = type;\n    }\n\n    /**\n     * Column is the primary key.  Only one column can have this set.\n     */\n    Key(value: boolean = true): Column {\n      this.isKey = value;\n      return this;\n    }\n\n    /**\n     * Create an index for this column for faster queries.\n     */\n    Index(value: boolean = true): Column {\n      this.isIndex = value;\n      return this;\n    }\n\n    /**\n     * Set a default value for the column\n     */\n     // TODO\n    Default(value: number | boolean | string): Column {\n      this.defaultValue = value;\n      return this;\n    }\n\n    /** create a column with 'INTEGER' affinity */\n    static Int(): Column {\n      return new Column(ColumnType.int);\n    }\n\n    /** create a column with 'REAL' affinity */\n    static Real(): Column {\n      return new Column(ColumnType.real);\n    }\n\n    /** create a column with 'BOOL' affinity */\n    static Bool(): Column {\n      return new Column(ColumnType.bool);\n    }\n\n    /** create a column with 'TEXT' affinity */\n    static Text(): Column {\n      return new Column(ColumnType.text);\n    }\n\n    /** create a column with 'TEXT' affinity */\n    static String(): Column {\n      return new Column(ColumnType.text);\n    }\n\n    /** create a column with 'BLOB' affinity */\n    static Blob(): Column {\n      var c = new Column(ColumnType.blob);\n      return c;\n    }\n\n    /** a javascript object with instance method 'toString' and class method 'get' (e.g. {@link https://github.com/adrai/enum}). */\n    static Enum(enum_: EnumClass | TypeScriptEnum): Column {\n      var c = new Column(ColumnType.enum);\n      c.enum = enum_;\n      return c;\n    }\n\n    /** a javascript Date objct, stored in db as seconds since Unix epoch (time_t) [note: precision is seconds] */\n    static Date(): Column {\n      return new Column(ColumnType.date);\n    }\n\n    /** a javascript Date objct, stored in db as seconds since Unix epoch (time_t) [note: precision is seconds] */\n    static DateTime(): Column {\n      return new Column(ColumnType.datetime);\n    }\n\n    /** object will be serialized & restored as JSON text */\n    static JSON(): Column {\n      return new Column(ColumnType.json);\n    }\n\n    /** points to an object in another table.  Its affinity will automatically be that table's key's affinity */\n    static Ptr(ref: ClassTemplate<any>): Column {\n      var c = new Column(ColumnType.ptr);\n      c.ref = ref;\n      return c;\n    }\n\n    /** unordered collection */\n    static Set(ref: ClassTemplate<any> /*| ColumnType*/): Column {\n      var c = new Column(ColumnType.set);\n      c.ref = ref;\n      return c;\n    }\n\n\n    static sql(val: Column) : string {\n      var stmt = \"\";\n      switch(val.type) {\n        case ColumnType.int:\n          stmt = 'INTEGER';\n          break;\n        case ColumnType.bool:\n          stmt = 'BOOL';\n          break;\n        case ColumnType.real:\n          stmt = 'REAL';\n          break;\n        case ColumnType.text:\n        case ColumnType.json:\n        case ColumnType.enum:\n          stmt = 'TEXT';\n          break;\n        case ColumnType.blob:\n          stmt = 'BLOB';\n          break;\n        case ColumnType.date:\n          stmt = 'DATE';\n          break;\n        case ColumnType.datetime:\n          stmt = 'DATETIME';\n          break;\n        default:\n          throw new Error(\"unsupported type\");\n      }\n\n      if('defaultValue' in val) {\n        stmt += ' DEFAULT ' + val.defaultValue;\n      }\n\n      return stmt;\n    }\n  }\n\n\n  export interface ColumnSet {\n    [name: string]: Column;\n  }\n\n\n  /**\n   * The parameters used to open a database\n   *\n   * @property name - the name of the database to open\n   */\n  export class StoreOptions {\n    name: string;\n  }\n\n\n  /**\n   * Database schema.  The outer keys will be the tables in the database.  The values will consist of an\n   * object whose keys will be the table's rows and values will be the row's type.  It will also have an\n   * '_indices' object with all the indices found.\n   * Note: tables or indices beginning with underscore or 'sqlite' will be ignored\n   *\n   * @private\n   * @example\n   * ```\n   *\n   *    var schema = {\n   *      'todos': {\n   *        _indices: {\n   *          'index_todos__name': 'CREATE INDEX ...',\n   *        },\n   *        _triggers: {\n   *          'trigger_todos__task': 'CREATE TRIGGER ...',\n   *        },\n   *        'id': 'INTEGER PRIMARY KEY',\n   *        'name': 'TEXT',\n   *      },\n   *      'tasks': {\n   *        'id': 'INTEGER PRIMARY KEY',\n   *        'description': 'TEXT',\n   *      }\n   *    };\n   * ```\n   */\n  export class Schema {\n    [table: string]: SchemaTable;\n  }\n\n  /**\n   * @private\n   */\n  export class SchemaTable {\n    _indices: Object;\n    _triggers: Object;\n    [column: string]: any;\n  }\n\n\n  /**\n   * Internal class used in key/value storage\n   * @private\n   */\n  class KeyValue extends Instance<string> {\n    static tableName: string = 'updraft_kv';\n    static columns: ColumnSet = {\n      key: Column.String().Key(),\n      value: Column.String(),\n    };\n    static all: Query<string, KeyValue>;\n    static get(id: string): Promise<KeyValue> { return null; }\n\n    key: string;\n    value: string;\n\n    constructor(props?: Object) {\n      super(props);\n    }\n  }\n\n\n  /**\n   * @private\n   */\n  export interface ExecCallback<T> {\n    (tx: SQLTransaction, results: SQLResultSet): T;\n  }\n\n  /**\n   * @private\n   */\n  function anyFcn(tx: SQLTransaction, results: SQLResultSet): any {}\n\n\n  /**\n   * Interface for creating classes & database interaction\n   */\n  export class Store {\n    logSql: boolean;\n    tables: ClassTemplate<any>[];\n    KeyValue: ClassTemplate<any>;\n    kv: Object;\n    db: Database;\n\n    constructor() {\n      var self = this;\n      this.logSql = false;\n\n      self.tables = [];\n      self.kv = {};\n\n      this.addClass(KeyValue);\n    }\n\n    /**\n     * create a new type whose instances can be stored in a database\n     * @param templ\n     */\n     addClass(templ: ClassTemplate<any>) {\n       MakeClassTemplate(templ, this);\n       this.tables.push(templ);\n     }\n\n\n    /**\n     * set a key/value pair\n     *\n     * @param key\n     * @param value - value will be stored as JSON text, so value can be any object that will\n     *        survive serialization\n     * @return a promise that will resolve once the value is saved.  Key/values are cached\n     *         on the <tt>Store</tt>, so you can use the value immediately and don't need to wait for\n     *         the promise to resolve.\n     */\n    set(key: string, value: Object): Promise<any> {\n      this.kv[key] = value;\n      var pair = new KeyValue({key: key, value: JSON.stringify(value)});\n      return this.save(pair);\n    }\n\n\n    /**\n     * gets a key/value pair.  Values are cached on the <tt>Store</tt> so they are immediately available\n     *\n     * @param key\n     * @return value\n     */\n    get(key: string): Object {\n      return this.kv[key];\n    }\n\n\n    /**\n     * read the key/value pairs from the database, caching them on the <tt>Store</tt>\n     * @private\n     */\n    loadKeyValues(): Promise<any> {\n      var self = this;\n      return KeyValue.all.get().then(function(vals: KeyValue[]) {\n        for(var i=0; i<vals.length; i++) {\n          var val = vals[i];\n          self.kv[val.key] = JSON.parse(val.value);\n        }\n      });\n    }\n\n\n    /**\n     * Delete all tables in database.  For development purposes; you probably don't want to ship with this.\n     *\n     * @param opts\n     * @return a promise that resolves when all tables are deleted\n     * @see {@link open}\n     * @example\n     * ```\n     *\n     *    store.purge({name: 'my cool db'}).then(function() {\n     *      // everything is gone\n     *    });\n     * ```\n     */\n    purge(opts: StoreOptions): Promise<any> {\n      console.assert(!this.db);\n\n      this.db = window.openDatabase(opts.name, '1.0', 'updraft created database', 5 * 1024 * 1024);\n      console.assert(this.db != null);\n\n      var self = this;\n      console.assert(this instanceof Store);\n      return self.readSchema()\n      .then(function(schema: Schema) {\n        return new Promise<any>(function(fulfill, reject) {\n          self.db.transaction(function(tx) {\n            var promises: Promise<any>[] = [];\n            Object.keys(schema).forEach(function(table) {\n              promises.push(self.exec(tx, 'DROP TABLE ' + table));\n            });\n            return Promise.all(promises)\n            .then(function() {\n              self.db = null;\n            })\n            .then(fulfill, reject);\n          });\n        });\n      });\n    }\n\n\n    /**\n     * open the database\n     *\n     * @param opts\n     * @return a promise that resolves with no parameters when the database is created and ready\n     * @example\n     * ```\n     *\n     *    store.open({name: 'my cool db'}).then(function() {\n     *      // start loading & saving objects\n     *    });\n     * ```\n     */\n    open(opts: StoreOptions): Promise<any> {\n      this.db = window.openDatabase(opts.name, '1.0', 'updraft created database', 5 * 1024 * 1024);\n      console.assert(this.db != null);\n\n      // add tables for 'set' columns\n      var setTables: ClassTemplate<any>[] = [];\n      for(var i=0; i<this.tables.length; i++) {\n        var table = this.tables[i];\n        for(var col in table.columns) {\n          if(table.columns[col].type === ColumnType.set) {\n            var ref = table.columns[col].ref;\n            console.assert(ref != null);\n            var setTable: ClassTemplate<number> = {\n              tableName: table.tableName + '_' + col,\n              recreate: table.recreate,\n              temp: table.temp,\n              key: '',\n              keyType: table.keyType,\n              columns: {},\n              indices: [ [table.key], [col] ],\n              get: function(id: number): Promise<Instance<number>> { throw new Error(\"not callable\"); }\n            };\n            setTable.columns[table.key] = new Column(table.keyType), // note: NOT setting key=true, as it would impose unique constraint\n            setTable.columns[col] = new Column(ref.keyType),\n            table.columns[col].setTable = setTable;\n            setTables.push(setTable);\n          }\n        }\n      }\n\n      this.tables = this.tables.concat(setTables);\n      var self = this;\n      console.assert(this instanceof Store);\n      return self.readSchema()\n              .then(self.syncTables.bind(self))\n              .then(self.loadKeyValues.bind(self));\n    }\n\n\n    /**\n     * close the database\n     */\n    close() {\n      this.db = null;\n      this.constructor();\n    }\n\n\n    /**\n     * exec a sql statement within a given transaction\n     *\n     * @param tx - a transaction created by <tt>db.transaction</tt> or <tt>db.readTransaction</tt>\n     * @param stmt - sql statement to execute\n     * @param args - array of strings to substitute into <tt>stmt</tt>\n     * @param callback - callback with parameters (transaction, [SQLResultSet]{@link http://www.w3.org/TR/webdatabase/#sqlresultset})\n     * @return a promise that resolves with (transaction, return value of the callback)\n     * @private\n     */\n    exec<T>(tx: SQLTransaction, stmt: string, args?: string[], callback: ExecCallback<T> = anyFcn): Promise<T> {\n      if(this.logSql) {\n        console.log(stmt, args);\n      }\n      var self = this;\n      return new Promise(function (fulfill, reject) {\n        try {\n          tx.executeSql(stmt, args,\n                        function (tx, results) {\n                          var ret = callback ? callback(tx, results) : null;\n                          return Promise.resolve(ret).then(fulfill, reject);\n                        },\n                        function (tx, error) {\n                          self.reportError(error);\n                          reject(error);\n                          return false;\n                        });\n        } catch (reason) {\n          console.log('Failed to exec \"' + stmt + '\":' + reason);\n          throw reason;\n        }\n      });\n    }\n\n\n    /**\n     * exec a sql statement within a new read transaction\n     *\n     * @param stmt - sql statement to execute\n     * @param args - array of strings to substitute into <tt>stmt</tt>\n     * @param callback - callback with parameters (transaction, [SQLResultSet]{@link http://www.w3.org/TR/webdatabase/#sqlresultset})\n     * @return a promise that resolves with (transaction, return value of the callback)\n     * @private\n     */\n    execRead<T>(stmt: string, args: string[], callback: ExecCallback<T>): Promise<T> {\n      var self = this;\n      console.assert(self.db != null);\n      return new Promise(function (fulfill, reject) {\n        self.db.readTransaction(function (rtx) {\n          return self.exec(rtx, stmt, args, callback)\n                  .then(fulfill, reject);\n        });\n      });\n    }\n\n\n    reportError(error: SQLError) {\n      switch (error.code) {\n        case error.SYNTAX_ERR:\n          console.log(\"Syntax error: \" + error.message);\n          break;\n        default:\n          console.log(error);\n      }\n    }\n\n\n    /**\n     * get the existing database's schema in object form\n     *\n     * @return a promise that resolves with the {@link Schema}\n     */\n    readSchema(): Promise<Schema> {\n      function tableFromSql(sql: string): SchemaTable {\n        var table = <SchemaTable>{ _indices: {}, _triggers: {} };\n        var matches = sql.match(/\\((.*)\\)/);\n        if (matches) {\n          var fields = matches[1].split(',');\n          for (var i = 0; i < fields.length; i++) {\n            var ignore = /^\\s*(primary|foreign)\\s+key/i;  // ignore standalone 'PRIMARY KEY xxx'\n            if (fields[i].match(ignore)) {\n              continue;\n            }\n            var quotedName = /\"(.+)\"\\s+(.*)/;\n            var unquotedName = /(\\w+)\\s+(.*)/;\n            var parts = fields[i].match(quotedName);\n            if (!parts) {\n              parts = fields[i].match(unquotedName);\n            }\n            if (parts) {\n              table[parts[1]] = parts[2];\n            }\n          }\n        }\n        return table;\n      }\n\n      return this.execRead('SELECT name, tbl_name, type, sql FROM sqlite_master', [], function (tx, results) {\n        /*jshint camelcase:false*/\n        var schema: Schema = {};\n        for (var i = 0; i < results.rows.length; i++) {\n          var row: any = results.rows.item(i);\n          if (row.name[0] != '_' && !startsWith(row.name, 'sqlite')) {\n            switch (row.type) {\n              case 'table':\n                schema[row.name] = tableFromSql(row.sql);\n                break;\n              case 'index':\n                schema[row.tbl_name]._indices = schema[row.tbl_name]._indices || {};\n                schema[row.tbl_name]._indices[row.name] = row.sql;\n                break;\n              case 'trigger':\n                schema[row.tbl_name]._triggers = schema[row.tbl_name]._triggers || {};\n                schema[row.tbl_name]._triggers[row.name] = row.sql;\n                break;\n            }\n          }\n        }\n        return schema;\n      });\n    }\n\n\n    /**\n     * Check whether the tables in the current database match up with the ClassFactories.\n     * They will be created or modified as needed.\n     *\n     * @param schema\n     * @return A promise that resolves with no parameters once all tables are up-to-date.\n     * @private\n     */\n    syncTables(schema: Schema): Promise<any> {\n      var self = this;\n      console.assert(self.db != null);\n      return new Promise(function (fulfill, reject) {\n        self.db.transaction(function (tx) {\n          return Promise.all(self.tables.map(function (f) { return self.syncTable(tx, schema, f); }))\n            .then(fulfill, reject);\n        });\n      });\n    }\n\n\n    /**\n     * Check whether an individual table in the current database matches up with its corresponding ClassTemplate.\n     * It will be created or modified as needed.\n     *\n     * @param tx - a writeable transaction\n     * @param schema\n     * @param f\n     * @return A promise that resolves with no parameters once the table is up-to-date.\n     * @private\n     */\n    syncTable(tx: SQLTransaction, schema: Schema, f: ClassTemplate<any>): Promise<any> {\n      var self = this;\n      // execute CREATE TABLE statement\n      function createTable(name: string): Promise<any> {\n        var cols: string[] = [];\n        for (var col in f.columns) {\n          var attrs: Column = f.columns[col];\n          var decl: string;\n          switch (attrs.type) {\n            case ColumnType.ptr:\n              console.assert(attrs.ref != null);\n              console.assert(attrs.ref.columns != null);\n              console.assert(attrs.ref.tableName != null);\n              console.assert(attrs.ref.key != null);\n              var foreignCol: Column = attrs.ref.columns[attrs.ref.key];\n              decl = col + ' ' + Column.sql(foreignCol);\n              cols.push(decl);\n              break;\n\n            case ColumnType.set:\n              break;\n\n            default:\n              decl = col + ' ' + Column.sql(attrs);\n              if (f.key === col) {\n                decl += ' PRIMARY KEY';\n              }\n              cols.push(decl);\n          }\n        }\n        return self.exec(tx, 'CREATE ' + (f.temp ? 'TEMP ' : '') + 'TABLE ' + name + ' (' + cols.join(', ') + ')');\n      }\n\n      function dropTable(name: string): Promise<any> {\n        return self.exec(tx, 'DROP TABLE ' + name);\n      }\n\n      function createIndices(force: boolean = false): Promise<any> {\n        var promises: Promise<any>[] = [];\n        var toRemove = (f.tableName in schema) ? clone(schema[f.tableName]._indices) : {};\n        f.indices.forEach(function (index: string[]) {\n          var name = 'index_' + f.tableName + '__' + index.join('_');\n          var sql = 'CREATE INDEX ' + name + ' ON ' + f.tableName + ' (' + index.join(', ') + ')';\n          delete toRemove[name];\n          var create = true;\n          var drop = false;\n          if (schema[f.tableName] && schema[f.tableName]._indices && schema[f.tableName]._indices[name]) {\n            if (schema[f.tableName]._indices[name] === sql) {\n              create = false;\n            } else {\n              drop = true;\n            }\n          }\n\n          if (drop) {\n            promises.push(self.exec(tx, 'DROP INDEX ' + name));\n          }\n          if (create || force) {\n            promises.push(self.exec(tx, sql));\n          }\n        });\n\n        // delete orphaned indices\n        Object.keys(toRemove).forEach(function (name: string) {\n          promises.push(self.exec(tx, 'DROP INDEX ' + name));\n        });\n        return Promise.all(promises);\n      }\n\n      // check if table already exists\n      if (f.tableName in schema) {\n        if (f.recreate) {\n          return Promise.all([\n            dropTable(f.tableName),\n            createTable(f.tableName),\n            createIndices(true),\n          ]);\n        } else {\n          //console.log(\"table \" + f.tableName + \" exists; checking columns\");\n          var columns = clone(schema[f.tableName]);\n          delete columns._indices;\n          delete columns._triggers;\n          var key: string;\n\n          var addedColumns: string[] = [];\n          var addedForeignKey = false;\n          for (key in f.columns) {\n            if (!(key in columns)) {\n              addedColumns.push(key);\n              if (f.columns[key].ref) {\n                addedForeignKey = true;\n              }\n            }\n          }\n\n          var renamedColumns = clone(f.renamedColumns) || {};\n          for (key in Object.keys(renamedColumns)) {\n            if (!(key in columns)) {\n              delete renamedColumns[key];\n            }\n          }\n\n          var deletedColumns = Object.keys(columns).filter(function (col) {\n            return !(col in f.columns);\n          });\n\n          if (addedForeignKey || Object.keys(renamedColumns).length > 0 || deletedColumns.length > 0) {\n            // must recreate table and migrate data\n            var copyData = function (oldName: string, newName: string) {\n              var oldTableColumns = Object.keys(columns).filter(function (col) { return (col in f.columns) || (col in renamedColumns); });\n              var newTableColumns = oldTableColumns.map(function (col) { return (col in renamedColumns) ? renamedColumns[col] : col; });\n              if(oldTableColumns.length && newTableColumns.length) {\n                var stmt = \"INSERT INTO \" + newName + \" (\" + newTableColumns.join(\", \") + \") \";\n                stmt += \"SELECT \" + oldTableColumns.join(\", \") + \" FROM \" + oldName + \";\";\n                return self.exec(tx, stmt);\n              }\n            };\n\n            var renameTable = function (oldName: string, newName: string) {\n              return self.exec(tx, 'ALTER TABLE ' + oldName + ' RENAME TO ' + newName);\n            };\n\n            var newTableName = 'new_' + f.tableName;\n            console.assert(!(newTableName in schema));\n\n            return Promise.all([\n                createTable(newTableName),\n                copyData(f.tableName, newTableName),\n                dropTable(f.tableName),\n                renameTable(newTableName, f.tableName),\n                createIndices(true)\n              ]);\n\n          } else if (addedColumns.length > 0) {\n            // alter table, add columns\n            var promises: Promise<any>[] = [];\n            addedColumns.forEach(function (columnName: string) {\n              var attrs: Column = f.columns[columnName];\n              var columnDecl = columnName + ' ' + Column.sql(attrs);\n              promises.push(self.exec(tx, 'ALTER TABLE ' + f.tableName + ' ADD COLUMN ' + columnDecl));\n            });\n            promises.push(createIndices());\n            return Promise.all(promises);\n          } else {\n            // no table modification is required\n            return createIndices();\n          }\n        }\n      } else {\n        //console.log('creating table: ' + f.tableName);\n        return Promise.all([\n          createTable(f.tableName),\n          createIndices(true)\n        ]);\n      }\n    }\n\n\n    /**\n     * Save all objects to database.  Atomic operation- all objects will be saved within the same transaction\n     * or nothing will be written.  Objects can be heterogeneous.\n     *\n     * @param objects - objects to save\n     */\n    save(...objects: Instance<any>[]) {\n      objects = Array.prototype.concat.apply([], objects); // flatten array\n\n      objects.map(function (o: Instance<any>) {\n        console.assert(('_' + o._model.key) in o, \"object must have a key\");\n      });\n\n      var self = this;\n\n      return new Promise(function (resolve, reject) {\n        self.db.transaction(function (tx: SQLTransaction): Promise<any> {\n          function value(o: Instance<any>, col: string) {\n            var val = o['_' + col];\n            switch(o._model.columns[col].type) {\n              case ColumnType.date:\n              case ColumnType.datetime:\n                if(typeof val !== 'undefined') {\n                  console.assert(val instanceof Date);\n                  val = Math.floor(val.getTime() / 1000);\n                }\n                break;\n\n              case ColumnType.json:\n                val = JSON.stringify(val);\n                break;\n\n              case ColumnType.enum:\n                console.assert(o._model.columns[col].enum != null);\n                val = val.toString();\n                break;\n\n              default:\n                console.assert(typeof val !== 'object');\n                break;\n            }\n            return val;\n          }\n\n          function insertSets(o: Instance<any>, force: boolean): Promise<boolean> {\n            var changes = o._changes();\n            var f = o._model;\n            var promises: Promise<void>[] = [];\n            Object.keys(f.columns)\n            .filter(function(col: string) {\n              return (f.columns[col].type === ColumnType.set) && (force || changes.indexOf(col) > -1);\n            })\n            .forEach(function(col: string) {\n              var ref = f.columns[col].ref;\n              var setTable = f.columns[col].setTable;\n              console.assert(ref != null);\n              console.assert(setTable != null);\n              var set: Set<any> = o['_' + col];\n              if(set) {\n                var key = o._primaryKey();\n                var deletions: string[] = set.getRemoved();\n                var additions: string[] = set.getAdded();\n                deletions.forEach(function(del: string) {\n                  promises.push( self.exec<void>(tx, 'DELETE FROM ' + setTable.tableName + ' WHERE ' + f.key + '=? AND ' + col + '=?', [ key, del ]) );\n                });\n                additions.forEach(function(add: string) {\n                  promises.push( self.exec<void>(tx, 'INSERT INTO ' + setTable.tableName + ' (' + f.key + ', ' + col + ') VALUES (?, ?)', [key, add]) );\n                });\n              }\n            });\n            return Promise.all(promises).then(() => true);\n          }\n\n          function insert(o: Instance<any>, callback: (changes: boolean) => Promise<boolean> = null): Promise<boolean> {\n            var f = o._model;\n            var isNotSet = function(col: string) { return f.columns[col].type !== ColumnType.set; };\n            var cols = Object.keys(f.columns).filter(isNotSet);\n            var columns = cols.join(', ');\n            var values = cols.map(function () { return '?'; }).join(', ');\n            var args = cols.map(function(col) { return value(o, col); });\n            return self.exec(tx, 'INSERT OR IGNORE INTO ' + f.tableName + ' (' + columns + ') VALUES (' + values + ')', args, function (tx, results) {\n              var changes = results.rowsAffected !== 0;\n              return callback ? callback(changes) : changes;\n            });\n          }\n\n          function update(o: Instance<any>, callback: (changes: boolean) => Promise<boolean> = null): Promise<boolean> {\n            var f = o._model;\n            var cols = o._changes();\n            var isNotSet = function(col: string) { return f.columns[col].type !== ColumnType.set; };\n            var isNotKey = function(col: string) { return col !== f.key; };\n            var assignments = cols\n              .filter(isNotSet)\n              .filter(isNotKey)\n              .map(function (col) { return col + '=?'; })\n              .join(', ');\n            var values = cols\n              .filter(isNotSet)\n              .filter(isNotKey)\n              .map(function(col) { return value(o, col); });\n            values.push(o['_' + f.key]); // for WHERE clause\n            return self.exec(tx, 'UPDATE OR IGNORE ' + f.tableName + ' SET ' + assignments + ' WHERE ' + f.key + '=?', values, function (tx, results) {\n              var changes = results.rowsAffected !== 0;\n              return callback ? callback(changes) : changes;\n            });\n          }\n\n          var upsert = function (o: Instance<any>): Promise<any> {\n            var p: Promise<any>;\n            if (o._isInDb) {\n              p = update(o, function (changed) { return changed ? insertSets(o, false) : insert(o); });\n            } else {\n              p = insert(o, function (changed) { return changed ? insertSets(o, true) : update(o); });\n            }\n            return p\n            .then(function (changed: boolean) {\n              console.assert(changed);\n              if(changed) {\n                o._clearChanges();\n                o._isInDb = true;\n              }\n            });\n          };\n\n          return Promise.all(objects.map(upsert)).then(resolve, reject);\n        });\n      });\n    }\n  }\n\n}\n","/// <reference path=\"./store.ts\" />\n/// <reference path=\"./query.ts\" />\n\nmodule Updraft {\n}\n\ndeclare var module: any;\nif(typeof module !== \"undefined\") {\n\tmodule.exports = Updraft;\n}"],"sourceRoot":"/source/"}